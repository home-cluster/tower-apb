FROM ansibleplaybookbundle/apb-base:canary

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IHRvd2VyLWFwYgpkZXNjcmlwdGlvbjogQVdYIEFQQiBJbXBsZW1l\
bnRhdGlvbgpiaW5kYWJsZTogRmFsc2UKYXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGRpc3Bs\
YXlOYW1lOiBBbnNpYmxlIFRvd2VyIChBUEIpCiAgbG9uZ0Rlc2NyaXB0aW9uOiBBbiBBUEIgdGhh\
dCBkZXBsb3lzIEFXWCAoVXBzdHJlYW0gQW5zaWJsZSBUb3dlcikKICBkb2N1bWVudGF0aW9uVXJs\
OiBodHRwczovL2RvY3MuYW5zaWJsZS5jb20vYW5zaWJsZS10b3dlci8KcGxhbnM6CiAgLSBuYW1l\
OiBhbGwtaW4tb25lCiAgICBkZXNjcmlwdGlvbjogQW4gQVBCIHRoYXQgZGVwbG95cyBBV1ggYW5k\
IHBvc3RncmVzcWwgdG9nZXRoZXIKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBk\
aXNwbGF5TmFtZTogQWxsLWluLW9uZQogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiBk\
ZXBsb3lzIGEgc2luZ2xlIEFXWCBpbnN0YW5jZSB3aXRoIGEgcG9zdGdyZXNxbCBiYWNrZW5kCiAg\
ICAgIGNvc3Q6ICQwLjAwCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IGFkbWluX2FwaV90\
b2tlbgogICAgICAgIHRpdGxlOiBBZG1pbiBBUEkgVG9rZW4KICAgICAgICBkZXNjcmlwdGlvbjog\
QW4gT3BlblNoaWZ0IEFQSSBUb2tlbiB3aXRoIGFkbWluLWxldmVsIHBlcm1pc3Npb25zLgogICAg\
ICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAtIG5hbWU6IHNr\
aXBfdGxzX3ZlcmlmeQogICAgICAgIHRpdGxlOiBTa2lwIE9wZW5TaGlmdCBUTFMgdmVyaWZ5CiAg\
ICAgICAgZGVzY3JpcHRpb246IElmIHRydWUsIHdpbGwgbm90IFRMUyB2ZXJpZnkgd2hlbiBtYWtp\
bmcgQVBJIHJlcXVlc3RzCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICByZXF1aXJlZDog\
ZmFsc2UKICAgICAgICB0eXBlOiBib29sCiAgICAgIC0gbmFtZTogcG9zdGdyZXNxbF9lbXB0eWRp\
cgogICAgICAgIHRpdGxlOiBQb3N0Z3JlU1FMIEVtcHR5RGlyCiAgICAgICAgZGVzY3JpcHRpb246\
IFVzZSBhbiBFbXRweURpciB0byBiYWNrIFBvc3RncmVTUUwgKG5vdCByZWNvbW1lbmRlZCBmb3Ig\
cHJvZHVjdGlvbikKICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIHJlcXVpcmVkOiBmYWxz\
ZQogICAgICAgIHR5cGU6IGJvb2wKICAgICAgLSBuYW1lOiBhd3hfaW1hZ2Vfb3JnCiAgICAgICAg\
dGl0bGU6IEFXWCBpbWFnZSBvcmdhbml6YXRpb24KICAgICAgICBkZXNjcmlwdGlvbjogdGhlIG9y\
Z2FuaXphdGlvbiB0byBwdWxsIGltYWdlcyBmcm9tCiAgICAgICAgZGVmYXVsdDogYW5zaWJsZQog\
ICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAtIG5hbWU6\
IGF3eF9pbWFnZV90YWcKICAgICAgICB0aXRsZTogQVdYIGltYWdlIHRhZwogICAgICAgIGRlc2Ny\
aXB0aW9uOiB0aGUgaW1hZ2UgdGFnIHRvIHB1bGwKICAgICAgICBkZWZhdWx0OiBsYXRlc3QKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgLSBuYW1lOiBh\
d3hfcG9zdGdyZXNxbF92b2x1bWVfY2FwYWNpdHkKICAgICAgICB0aXRsZTogUG9zdGdyZVNRTCB2\
b2x1bWUgY2FwYWNpdHkKICAgICAgICBkZXNjcmlwdGlvbjogdGhlIHNpemUgb2YgdGhlIHBlcnNp\
c3RlbnQgdm9sdW1lIGJhY2tpbmcgUG9zdGdyZVNRTCAoaW4gR0IpCiAgICAgICAgZGVmYXVsdDog\
NQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQoKICAtIG5hbWU6\
IGV4dGVybmFsLXBnCiAgICBkZXNjcmlwdGlvbjogQVdYIHdpdGggYW4gZXh0ZXJuYWwgZGF0YWJh\
c2UKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRXh0ZXJu\
YWwKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVwbG95cyBhIHNpbmdsZSBBV1gg\
aW5zdGFuY2UgdXNpbmcgYW4gZXh0ZXJuYWwgUG9zdGdyZVNRTCBiYWNrZW5kCiAgICAgIGNvc3Q6\
ICQwLjAwCiAgICBwYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IGFkbWluX2FwaV90b2tlbgogICAg\
ICAgIHRpdGxlOiBBZG1pbiBBUEkgVG9rZW4KICAgICAgICBkZXNjcmlwdGlvbjogQW4gT3BlblNo\
aWZ0IEFQSSBUb2tlbiB3aXRoIGFkbWluLWxldmVsIHBlcm1pc3Npb25zLgogICAgICAgIHJlcXVp\
cmVkOiBmYWxzZQogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAtIG5hbWU6IHNraXBfdGxzX3Zl\
cmlmeQogICAgICAgIHRpdGxlOiBTa2lwIE9wZW5TaGlmdCBUTFMgdmVyaWZ5CiAgICAgICAgZGVz\
Y3JpcHRpb246IElmIHRydWUsIHdpbGwgbm90IFRMUyB2ZXJpZnkgd2hlbiBtYWtpbmcgQVBJIHJl\
cXVlc3RzCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAg\
ICAgICB0eXBlOiBib29sCiAgICAgIC0gbmFtZTogYXd4X2FkbWluX3Bhc3N3b3JkCiAgICAgICAg\
dGl0bGU6IEFXWCBBZG1pbiBQYXNzd29yZAogICAgICAgIGRlc2NyaXB0aW9uOiBUaGUgcGFzc3dv\
cmQgZm9yIGFkbWluIHVzZXIKICAgICAgICBkZWZhdWx0OiBwYXNzd29yZAogICAgICAgIHJlcXVp\
cmVkOiBmYWxzZQogICAgICAtIG5hbWU6IGF3eF9pbWFnZV9vcmcKICAgICAgICB0aXRsZTogQVdY\
IGltYWdlIG9yZ2FuaXphdGlvbgogICAgICAgIGRlc2NyaXB0aW9uOiB0aGUgb3JnYW5pemF0aW9u\
IHRvIHB1bGwgaW1hZ2VzIGZyb20KICAgICAgICBkZWZhdWx0OiBhbnNpYmxlCiAgICAgICAgdHlw\
ZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IGZhbHNlCiAgICAgIC0gbmFtZTogYXd4X2ltYWdl\
X3RhZwogICAgICAgIHRpdGxlOiBBV1ggaW1hZ2UgdGFnCiAgICAgICAgZGVzY3JpcHRpb246IHRo\
ZSBpbWFnZSB0YWcgdG8gcHVsbAogICAgICAgIGRlZmF1bHQ6IGxhdGVzdAogICAgICAgIHR5cGU6\
IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiBmYWxzZQogICAgICAtIG5hbWU6IGF3eF9wb3N0Z3Jl\
c3FsX2hvc3RuYW1lCiAgICAgICAgdGl0bGU6IFBvc3RncmVTUUwgaG9zdG5hbWUKICAgICAgICBk\
ZXNjcmlwdGlvbjogdGhlIGhvc3RuYW1lIG9mIHRoZSBQb3N0Z3JlU1FMIGRhdGFiYXNlCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSBuYW1lOiBhd3hf\
cG9zdGdyZXNxbF9kYm5hbWUKICAgICAgICB0aXRsZTogUG9zdGdyZVNRTCBkYXRhYmFzZSBuYW1l\
CiAgICAgICAgZGVzY3JpcHRpb246IHRoZSBuYW1lIG9mIHRoZSBQb3N0Z3JlU1FMIGRhdGFiYXNl\
CiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSBuYW1l\
OiBhd3hfcG9zdGdyZXNxbF91c2VyCiAgICAgICAgdGl0bGU6IFBvc3RncmVTUUwgdXNlciBuYW1l\
CiAgICAgICAgZGVzY3JpcHRpb246IHRoZSBuYW1lIG9mIHRoZSBQb3N0Z3JlU1FMIHVzZXIKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIG5hbWU6IGF3\
eF9wb3N0Z3Jlc3FsX3Bhc3N3b3JkCiAgICAgICAgdGl0bGU6IFBvc3RncmVTUUwgcGFzc3dvcmQK\
ICAgICAgICBkZXNjcmlwdGlvbjogdGhlIHBhc3N3b3JkIHRvIHRoZSBQb3N0Z3JlU1FMIGRhdGFi\
YXNlCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSBu\
YW1lOiBhd3hfcG9zdGdyZXNxbF9wb3J0CiAgICAgICAgdGl0bGU6IFBvc3RncmVTUUwgcG9ydAog\
ICAgICAgIGRlc2NyaXB0aW9uOiB0aGUgcG9ydCB0aGUgUG9zdGdyZVNRTCBkYXRhYmFzZSBpcyBs\
aXN0ZW5pbmcgb24KICAgICAgICBkZWZhdWx0OiA1NDMyCiAgICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgICAgcmVxdWlyZWQ6IGZhbHNlCgogIC0gbmFtZTogYmluZC1wZwogICAgZGVzY3JpcHRpb246\
IEFXWCB3aXRoIGJpbmQgY3JlZGVudGlhbHMKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgog\
ICAgICBkaXNwbGF5TmFtZTogQmluZAogICAgICBsb25nRGVzY3JpcHRpb246IFRoaXMgcGxhbiBk\
ZXBsb3lzIGEgc2luZ2xlIEFXWCBpbnN0YW5jZSB1c2luZyBiaW5kIGNyZWRlbnRpYWxzIGZyb20g\
YSBwcm92aXNpb25lZCBQb3N0Z3JlU1FMIGluc3RhbmNlCiAgICAgIGNvc3Q6ICQwLjAwCiAgICBw\
YXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IGFkbWluX2FwaV90b2tlbgogICAgICAgIHRpdGxlOiBB\
ZG1pbiBBUEkgVG9rZW4KICAgICAgICBkZXNjcmlwdGlvbjogQW4gT3BlblNoaWZ0IEFQSSBUb2tl\
biB3aXRoIGFkbWluLWxldmVsIHBlcm1pc3Npb25zLgogICAgICAgIHJlcXVpcmVkOiBmYWxzZQog\
ICAgICAgIHR5cGU6IHN0cmluZwogICAgICAtIG5hbWU6IHNraXBfdGxzX3ZlcmlmeQogICAgICAg\
IHRpdGxlOiBTa2lwIE9wZW5TaGlmdCBUTFMgdmVyaWZ5CiAgICAgICAgZGVzY3JpcHRpb246IHNr\
aXAgVExTIHZlcmlmeSB3aGVuIG1ha2luZyBPcGVuU2hpZnQgQVBJIHJlcXVlc3RzCiAgICAgICAg\
ZGVmYXVsdDogZmFsc2UKICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgICB0eXBlOiBib29s\
CiAgICAgIC0gbmFtZTogYXd4X2ltYWdlX29yZwogICAgICAgIHRpdGxlOiBBV1ggaW1hZ2Ugb3Jn\
YW5pemF0aW9uCiAgICAgICAgZGVzY3JpcHRpb246IHRoZSBvcmdhbml6YXRpb24gdG8gcHVsbCBp\
bWFnZXMgZnJvbQogICAgICAgIGRlZmF1bHQ6IGFuc2libGUKICAgICAgICB0eXBlOiBzdHJpbmcK\
ICAgICAgICByZXF1aXJlZDogZmFsc2UKICAgICAgLSBuYW1lOiBhd3hfaW1hZ2VfdGFnCiAgICAg\
ICAgdGl0bGU6IEFXWCBpbWFnZSB0YWcKICAgICAgICBkZXNjcmlwdGlvbjogdGhlIGltYWdlIHRh\
ZyB0byBwdWxsCiAgICAgICAgZGVmYXVsdDogbGF0ZXN0CiAgICAgICAgdHlwZTogc3RyaW5nCiAg\
ICAgICAgcmVxdWlyZWQ6IGZhbHNlCgo="

RUN curl -L https://github.com/ansible/awx/archive/devel.tar.gz -o /tmp/awx.tar.gz \
  && mkdir -p /usr/share/awx_installer \
  && tar --strip-components=1 -xvf /tmp/awx.tar.gz -C /usr/share/awx_installer \
  && rm -f /tmp/awx.tar.gz

RUN cp /usr/share/awx_installer/installer/inventory /etc/ansible/hosts

ADD playbooks /opt/apb/actions
ADD . /opt/ansible/roles/tower-apb

RUN chmod -R g=u /opt/{ansible,apb}

USER apb
